#! /bin/bash

#triumphant-coal
#BIN=/share/apps/vasp/vasp.5.4.4/bin/vasp_gpu

#carbon
BIN=/share/apps/vasp/bins/5.4.4-p1-cuda10-intel19/vasp_gpu

LANG=en_US

pwd=$(pwd)

echo "#lp   vol           nspe           fme            afm1e          afm2e" >> output/data

#startloop
for i in $(seq 8 0.125 9); do

printf -- "\n\n         **------------------------------------------** \n"
printf -- "        **-- Running for lattice parameter a = $i --**" ;
printf -- "\n         **------------------------------------------** \n\n\n"



#start of non-spin-polarized

printf -- "\n ************************\n" ;
printf -- " ** Non-spin polarized **\n" ;
printf -- " ************************\n\n" ;

mkdir non-spin-polarized/$i

cp resources/INCAR-non-spin-polarized non-spin-polarized/$i/INCAR
cp resources/KPOINTS non-spin-polarized/$i/KPOINTS
cp resources/POTCAR non-spin-polarized/$i/POTCAR

cat > non-spin-polarized/$i/POSCAR <<!
NiO
$i
        1.0000000000         0.0000000000         0.0000000000
        0.0000000000         1.0000000000         0.0000000000
        0.0000000000         0.0000000000         1.0000000000
   Ni    O
   32   32
Direct
     0.000000000         0.000000000         0.000000000
     0.000000000         0.000000000         0.500000000
     0.000000000         0.500000000         0.000000000
     0.000000000         0.500000000         0.500000000
     0.500000000         0.000000000         0.000000000
     0.500000000         0.000000000         0.500000000
     0.500000000         0.500000000         0.000000000
     0.500000000         0.500000000         0.500000000
     0.000000000         0.250000000         0.250000000
     0.000000000         0.250000000         0.750000000
     0.000000000         0.750000000         0.250000000
     0.000000000         0.750000000         0.750000000
     0.500000000         0.250000000         0.250000000
     0.500000000         0.250000000         0.750000000
     0.500000000         0.750000000         0.250000000
     0.500000000         0.750000000         0.750000000
     0.250000000         0.000000000         0.250000000
     0.250000000         0.000000000         0.750000000
     0.250000000         0.500000000         0.250000000
     0.250000000         0.500000000         0.750000000
     0.750000000         0.000000000         0.250000000
     0.750000000         0.000000000         0.750000000
     0.750000000         0.500000000         0.250000000
     0.750000000         0.500000000         0.750000000
     0.250000000         0.250000000         0.000000000
     0.250000000         0.250000000         0.500000000
     0.250000000         0.750000000         0.000000000
     0.250000000         0.750000000         0.500000000
     0.750000000         0.250000000         0.000000000
     0.750000000         0.250000000         0.500000000
     0.750000000         0.750000000         0.000000000
     0.750000000         0.750000000         0.500000000
     0.250000000         0.000000000         0.000000000
     0.250000000         0.000000000         0.500000000
     0.250000000         0.500000000         0.000000000
     0.250000000         0.500000000         0.500000000
     0.750000000         0.000000000         0.000000000
     0.750000000         0.000000000         0.500000000
     0.750000000         0.500000000         0.000000000
     0.750000000         0.500000000         0.500000000
     0.250000000         0.250000000         0.250000000
     0.250000000         0.250000000         0.750000000
     0.250000000         0.750000000         0.250000000
     0.250000000         0.750000000         0.750000000
     0.750000000         0.250000000         0.250000000
     0.750000000         0.250000000         0.750000000
     0.750000000         0.750000000         0.250000000
     0.750000000         0.750000000         0.750000000
     0.000000000         0.000000000         0.250000000
     0.000000000         0.000000000         0.750000000
     0.000000000         0.500000000         0.250000000
     0.000000000         0.500000000         0.750000000
     0.500000000         0.000000000         0.250000000
     0.500000000         0.000000000         0.750000000
     0.500000000         0.500000000         0.250000000
     0.500000000         0.500000000         0.750000000
     0.000000000         0.250000000         0.000000000
     0.000000000         0.250000000         0.500000000
     0.000000000         0.750000000         0.000000000
     0.000000000         0.750000000         0.500000000
     0.500000000         0.250000000         0.000000000
     0.500000000         0.250000000         0.500000000
     0.500000000         0.750000000         0.000000000
     0.500000000         0.750000000         0.500000000

!

mpirun -np 4 -wdir $pwd/non-spin-polarized/$i/ vasp_gpu

rm non-spin-polarized/$i/POTCAR
#end of non spin polarized

#start of fm

printf -- "\n *******************\n" ;
printf -- " ** Ferromagnetic **\n" ;
printf -- " *******************\n\n" ;

mkdir fm/$i

cp resources/INCAR-fm fm/$i/INCAR
cp resources/KPOINTS fm/$i/KPOINTS
cp resources/POTCAR fm/$i/POTCAR

cp non-spin-polarized/$i/POSCAR fm/$i/POSCAR
cp non-spin-polarized/$i/WAVECAR fm/$i/WAVECAR
cp non-spin-polarized/$i/CHGCAR fm/$i/CHGCAR

mpirun -np 4 -wdir $pwd/fm/$i/ vasp_gpu

#it's huge.
rm fm/$i/WAVECAR

#end of fm

#start of afm1

printf -- "\n **********\n" ;
printf -- " ** AFM1 **\n" ;
printf -- " **********\n\n" ;

mkdir afm1/$i

cp resources/INCAR-afm1 afm1/$i/INCAR
cp resources/KPOINTS afm1/$i/KPOINTS
cp resources/POTCAR afm1/$i/POTCAR

cat > afm1/$i/POSCAR <<!
NiO
$i
        1.0000000000         0.0000000000         0.0000000000
        0.0000000000         1.0000000000         0.0000000000
        0.0000000000         0.0000000000         1.0000000000
   Ni    O
   32   32
Direct
     0.000000000         0.000000000         0.000000000
     0.000000000         0.000000000         0.500000000
     0.000000000         0.500000000         0.000000000
     0.000000000         0.500000000         0.500000000
     0.500000000         0.000000000         0.000000000
     0.500000000         0.000000000         0.500000000
     0.500000000         0.500000000         0.000000000
     0.500000000         0.500000000         0.500000000
     0.250000000         0.250000000         0.000000000
     0.250000000         0.250000000         0.500000000
     0.250000000         0.750000000         0.000000000
     0.250000000         0.750000000         0.500000000
     0.750000000         0.250000000         0.000000000
     0.750000000         0.250000000         0.500000000
     0.750000000         0.750000000         0.000000000
     0.750000000         0.750000000         0.500000000
     0.250000000         0.000000000         0.250000000
     0.250000000         0.000000000         0.750000000
     0.250000000         0.500000000         0.250000000
     0.250000000         0.500000000         0.750000000
     0.750000000         0.000000000         0.250000000
     0.750000000         0.000000000         0.750000000
     0.750000000         0.500000000         0.250000000
     0.750000000         0.500000000         0.750000000
     0.000000000         0.250000000         0.250000000
     0.000000000         0.250000000         0.750000000
     0.000000000         0.750000000         0.250000000
     0.000000000         0.750000000         0.750000000
     0.500000000         0.250000000         0.250000000
     0.500000000         0.250000000         0.750000000
     0.500000000         0.750000000         0.250000000
     0.500000000         0.750000000         0.750000000
     0.250000000         0.250000000         0.250000000
     0.250000000         0.250000000         0.750000000
     0.250000000         0.750000000         0.250000000
     0.250000000         0.750000000         0.750000000
     0.750000000         0.250000000         0.250000000
     0.750000000         0.250000000         0.750000000
     0.750000000         0.750000000         0.250000000
     0.750000000         0.750000000         0.750000000
     0.000000000         0.000000000         0.250000000
     0.000000000         0.000000000         0.750000000
     0.000000000         0.500000000         0.250000000
     0.000000000         0.500000000         0.750000000
     0.500000000         0.000000000         0.250000000
     0.500000000         0.000000000         0.750000000
     0.500000000         0.500000000         0.250000000
     0.500000000         0.500000000         0.750000000
     0.000000000         0.250000000         0.000000000
     0.000000000         0.250000000         0.500000000
     0.000000000         0.750000000         0.000000000
     0.000000000         0.750000000         0.500000000
     0.500000000         0.250000000         0.000000000
     0.500000000         0.250000000         0.500000000
     0.500000000         0.750000000         0.000000000
     0.500000000         0.750000000         0.500000000
     0.250000000         0.000000000         0.000000000
     0.250000000         0.000000000         0.500000000
     0.250000000         0.500000000         0.000000000
     0.250000000         0.500000000         0.500000000
     0.750000000         0.000000000         0.000000000
     0.750000000         0.000000000         0.500000000
     0.750000000         0.500000000         0.000000000
     0.750000000         0.500000000         0.500000000
!


cp non-spin-polarized/$i/WAVECAR afm1/$i/WAVECAR
cp non-spin-polarized/$i/CHGCAR afm1/$i/CHGCAR

mpirun -np 4 -wdir $pwd/afm1/$i/ vasp_gpu

#it's huge.
rm afm1/$i/WAVECAR
#end of afm1

#start of afm2

printf -- "\n **********\n" ;
printf -- " ** AFM2 **\n" ;
printf -- " **********\n\n" ;

mkdir afm2/$i

cp resources/INCAR-afm2 afm2/$i/INCAR
cp resources/KPOINTS afm2/$i/KPOINTS
cp resources/POTCAR afm2/$i/POTCAR

cat > afm2/$i/POSCAR <<!
NiO
$i
        1.0000000000         0.0000000000         0.0000000000
        0.0000000000         1.0000000000         0.0000000000
        0.0000000000         0.0000000000         1.0000000000
   Ni    O
   32   32
Direct
     0.000000000         0.000000000         0.000000000
     0.250000000         0.250000000         0.500000000
     0.500000000         0.500000000         0.000000000
     0.750000000         0.750000000         0.500000000
     0.250000000         0.500000000         0.250000000
     0.500000000         0.750000000         0.750000000
     0.750000000         0.000000000         0.250000000
     0.000000000         0.250000000         0.750000000
     0.500000000         0.000000000         0.500000000
     0.750000000         0.250000000         0.000000000
     0.000000000         0.500000000         0.500000000
     0.250000000         0.750000000         0.000000000
     0.750000000         0.500000000         0.750000000
     0.000000000         0.750000000         0.250000000
     0.250000000         0.000000000         0.750000000
     0.500000000         0.250000000         0.250000000
     0.500000000         0.500000000         0.500000000
     0.750000000         0.750000000         0.000000000
     0.000000000         0.000000000         0.500000000
     0.250000000         0.250000000         0.000000000
     0.750000000         0.000000000         0.750000000
     0.000000000         0.250000000         0.250000000
     0.250000000         0.500000000         0.750000000
     0.500000000         0.750000000         0.250000000
     0.000000000         0.500000000         0.000000000
     0.250000000         0.750000000         0.500000000
     0.500000000         0.000000000         0.000000000
     0.750000000         0.250000000         0.500000000
     0.250000000         0.000000000         0.250000000
     0.500000000         0.250000000         0.750000000
     0.750000000         0.500000000         0.250000000
     0.000000000         0.750000000         0.750000000
     0.250000000         0.250000000         0.250000000
     0.500000000         0.500000000         0.750000000
     0.750000000         0.750000000         0.250000000
     0.000000000         0.000000000         0.750000000
     0.500000000         0.750000000         0.500000000
     0.750000000         0.000000000         0.000000000
     0.000000000         0.250000000         0.500000000
     0.250000000         0.500000000         0.000000000
     0.750000000         0.250000000         0.750000000
     0.000000000         0.500000000         0.250000000
     0.250000000         0.750000000         0.750000000
     0.500000000         0.000000000         0.250000000
     0.000000000         0.750000000         0.000000000
     0.250000000         0.000000000         0.500000000
     0.500000000         0.250000000         0.000000000
     0.750000000         0.500000000         0.500000000
     0.750000000         0.750000000         0.750000000
     0.000000000         0.000000000         0.250000000
     0.250000000         0.250000000         0.750000000
     0.500000000         0.500000000         0.250000000
     0.000000000         0.250000000         0.000000000
     0.250000000         0.500000000         0.500000000
     0.500000000         0.750000000         0.000000000
     0.750000000         0.000000000         0.500000000
     0.250000000         0.750000000         0.250000000
     0.500000000         0.000000000         0.750000000
     0.750000000         0.250000000         0.250000000
     0.000000000         0.500000000         0.750000000
     0.500000000         0.250000000         0.500000000
     0.750000000         0.500000000         0.000000000
     0.000000000         0.750000000         0.500000000
     0.250000000         0.000000000         0.000000000
!


cp non-spin-polarized/$i/WAVECAR afm2/$i/WAVECAR
cp non-spin-polarized/$i/CHGCAR afm2/$i/CHGCAR

mpirun -np 4 -wdir $pwd/afm2/$i/ vasp_gpu

#it's huge.
rm afm2/$i/WAVECAR
#end of afm2

#extraction of data

VOL=`echo "scale=32;$i*$i*$i" | bc` ; 

NSPE=`awk '/F=/ {print $3}' non-spin-polarized/$i/OSZICAR` ;
FME=`awk '/F=/ {print $3}' fm/$i/OSZICAR` ;
AFM1E=`awk '/F=/ {print $3}' afm1/$i/OSZICAR` ;
AFM2E=`awk '/F=/ {print $3}' afm2/$i/OSZICAR` ;

echo $VOL $NSPE >> non-spin-polarized/F_vs_vol
echo $VOL $FME >> fm/F_vs_vol
echo $VOL $AFM1E >> afm1/F_vs_vol
echo $VOL $AFM2E >> afm2/F_vs_vol

echo $i $VOL $NSPE $FME $AFM1E $AFM2E >> output/data

rm non-spin-polarized/$i/WAVECAR
done
#end loop
